# @hectorjs/stub-backend

## Quality measures

![](https://github.com/HecJimSan/stub-backend/workflows/%40hectorjs%2Fstub%2Dbackend/badge.svg)
 - ![](https://github.com/HecJimSan/stub-backend/workflows/eslint%2Dconfig%2Dgoogle/badge.svg)
 - ![](https://github.com/HecJimSan/stub-backend/workflows/Unit%20tests/badge.svg)
 - ![](https://github.com/HecJimSan/stub-backend/workflows/Coverage/badge.svg)

 ## Others measures

 - ![](https://img.shields.io/npm/v/@hectorjs/stub-backend?label=version&logo=npm)
 - ![](https://img.shields.io/npm/dt/@hectorjs/stub-backend?logo=npm&logoColor=blue)
 - ![](https://img.shields.io/snyk/vulnerabilities/npm/@hectorjs/stub-backend?logo=snyk)
 - ![](https://img.shields.io/github/last-commit/HecJimSan/stub-backend?logo=github)

# Description

The aim of this project is to mock backend services building different responses for a given authentication, cookie, request among others.

Make the life easier for a nice development :smile:

# Install

```sh
npm install -g @hectorjs/stub-backend
```

# CLI

Verify your **hjs** command is installed correctly.

```sh
hjs --version
```

```sh
hjs test
```
You should see a health test generated by default.

## Commands

### ```hjs --help```
 It will display posible options available in the library.

### ```hjs new/n [name-mock-service]```  
It creates a new project with the name provided in the brakets.

### ```hjs generate/g [method] [name-path]```  
It will generate a method template resource with a test. For example , ```hjs g get customers/{id}/business?product={param}```). More info: ```hjs g --help```.
You can generate different methods like get, head, post, delete among others.

For each method, it creates a test with dummy data. It will reduce the time to test the mock. Give it a try. 

_NOTE:_ The endpoint should not start with '/' for the cli and you should escape '&' like the next example:

```hjs g post customers/{id}/products?query={param1}\&identifier={identifier}```

### ```hjs test```

Execute the tests which have been created by each method generate command (```hjs g get ...```).

_NOTE_: you can run ```npm test``` as well.

### ```hjs start```
If you want to run the mock ```hjs start```.

_NOTE:_ you can run ```npm start``` as well.

## Methods availabe to mock at this moment

- [x] GET
- [x] HEAD
- [x] POST
- [x] PUT
- [x] DELETE
- [x] OPTIONS
- [x] TRACE
- [x] PATCH

# UI

This section is in progress at this moment.

You can run the application and navigate to ```http://localhost:3005/``` and have a look.

# Usage
## Shortcut
### Install the library locally

#### Execute npm init with your data:
```
npm init -y
```
#### Install the library 
```
npm install @hectorjs/stub-backend
```
#### Copy the bin field bellow in the package.json file at the same level of the version:

```json
  "version" :"example",
  "bin":{
    "hjs":"node_modules/@hectorjs/stub-backend/bin/hjs"
  }
```

#### Add library to your runner file

Create a javascript file and add the library @hectorjs/stub-backend

```js
const hectorjs = require('@hectorjs/stub-backend')
```

Note: add the previous line in app.js file

## Folder data

Create a folder named _resources_ and add a couple of json files under that folder (it does not matter the name of the files) with the properties.

```
 resources
    Â¦
     - *.json
     - *.json
     - ...
```
The json must follow the next format:

### Method level 
The first key means the method and it must have a "_" as a prefix. For example:

    ```json
    {
      "_get":{
          
      },
      "_post":{
          
      }
      
    }
    ```

### Path level

The next level means the endpoint. The path is written like theses examples:

  - /customers/names
  - /customers/{id}/name
  - /countries/{id}/product
  - /countries/{id}/population?town={param1}&postcode={param2}

     ```json
    {
      "_get":{
         "/customers/names":[
           {}
         ]
      },
      "_post":{
          "/countries/{id}/product":[
            {}
          ]
      }
    }
    ```
_NOTE_: id, param1 or param2 can be named as you want.

### Array of scenarios

An array of possible responses based on different identifiers.

Each scenario contains different properties like **_id**, **_headers**, **_cookies** or **_description** among others.

#### _[idsKeys]
Identifiers of a path. For example, given a path ```/customers/{id}/data```, the scenario with an id should be structured like this:
```json
  "/customers/{id}/data" : [
    {

      "_id": "chris"

    },
    {

      "_id": "fran"

    }
  ]
```
#### _headers

There are two different ways to validate the headers:

##### Validate by key
It is an array of header keys. Basically, it will validate if the request contains the header in the array. If the request does not contain the header, the service will return a 401 response.

```json
  "/customers/{id}/data" : [
    {
      "_headers": ["authorization", "client_Id"]
    }
  ]
```

##### Validate by key and value
It is an array of objects. The key is the header name and the value is the header value. You can see in the next example:


```json
  "/customers/{id}/data" : [
    {
      "_headers": [{"authorization":"1234"},{ "client_Id":"121"}]
    }
  ]
```

_NOTE:_ If the scenario does not contain any headers section, the service won't check anything.

Capital letters are not allow in headers section.

#### _cookies
There are two different ways to validate the cookies:
##### Validate by key
It is an array of cookies keys. Basically, it will validate if the request contains the cookie in the array. If the request does not contain the cookie,the service will return a 401 response.

```json
  "/customers/{id}/data" : [
    {
      "_cookies": ["Universal", "sec"]
    }
  ]
```

##### Validate by key and value 
It is an array of objects. The key is the header name and the value is the header value. You can see in the next example:

```json
  "/customers/{id}/data" : [
    {
      "_cookies": [{"Universal":"123"}, {"sec":"1232"}]
    }
  ]
```

_NOTE:_ If the scenario does not contain any cookies section, the service won't check anything.
#### _description
Brief explanation about the scenario.

```json
  "_description":"secure scenario given an authorization header"
```
#### _status
Just in case the request contain the cookie and headers, you can set your own status or leave it 200 as default.

```json
  "_status":"500"
```
#### _body
This section contains the response for a given request.

```json
  "_body": {
    "dummyResponse": "anyValue"
     
  }
```

#### _requestBody

Some methods like post, put or delete needs to verify the body response as well. **requestBody** is the request for a specific scenario.

```json
  "_requestBody": {
    "dummyRequestBody": "anyValue"
     
  }
```
_Note:_ If any field is missed, it means it is not required.

Below, we have a example:

```json
{
  "_get": {
    "/stories/{id}/person$": [
      {
        "_id": "Nathan",
        "_headers": [],
        "_description": "Get person details related to  Nathan without authentication",
        "_body": {
          "name": "Nathan"
        }
      },
      {
        "_id": "Lucas",
        "_headers": [],
        "_status": 304,
        "_description": "There won't be any response    because the status is 304",
        "_body": {
          "name": "Nathan"
        }
      },
      {
        "_id": "mark",
        "_headers": ["authorization"],
        "_cookies": [],
        "_description": "Get person details related to Mark     with authentication",
        "_body": {
          "name": "Mark"
        }
      }
    ],
  },
  "_post" :{
      "/stories/{id}/budget": [
        {
          "_id": "Nathan",
          "_headers": ["Client_id"],
          "_cookies": [
            "session-id",
            "key-id"
          ],
          "_description": "Get budget details related to  Nathan with authentication",
          "_requestBody": {
            "anyData": "anyData"
          },
          "_body": {
            "name": "Nathan"
          }
        }
      ]
  }
}
```

If you want to test it, copy the previous example and paste it in one of the json files. Then execute the following command:

```sh
node app.js
```

The service will be running in the port *3005* waiting for a request.

Make a request:

```sh
curl http://localhost:3005/stories/nathan/person
```

The response will be like this:

```json
{
    "name": "Nathan"
}
```

# Respository

https://github.com/HecJimSan/stub-backend
